<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title }}</title>
    <link rel="icon" type="image/jpeg" href="{{ '/assets/img/avatar.png' | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script>
        (function() {
            const theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    {% if page.katex %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false},
                    {left: '\\(', right: '\\)', display: false},
                    {left: '\\[', right: '\\]', display: true}
                ],
                throwOnError : false
            });
        });
    </script>
    {% endif %}
</head>
<body>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container nav-wrapper">
            <a href="{{ '/' | relative_url }}" class="nav-brand">{{ site.title }}</a>
            
            <button class="nav-toggle" id="nav-toggle" aria-label="Toggle Navigation">
                <i class="fas fa-bars"></i>
            </button>

            <div class="nav-links" id="nav-links">
                {% for link in site.navigation %}
                <a href="{{ link.url | relative_url }}">{{ link.title }}</a>
                {% endfor %}
                <button id="theme-toggle" class="theme-toggle" aria-label="Toggle Dark Mode">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        {% if page.layout_type == 'home' %}
            <!-- Single Column Layout with Hero Header -->
            <div class="home-layout">
                <header class="home-header">
                    <div class="header-text">
                        <h1 class="header-name">{{ page.header_name | default: page.title }}</h1>
                        <div class="header-bio">{{ page.bio | markdownify }}</div>
                        <div class="header-email">{{ page.email }}</div>
                        
                        <div class="header-actions">
                            <!-- Social Icons -->
                            <div class="social-links">
                                {% for social in page.socials %}
                                <a href="{{ social.url }}" target="_blank" rel="noopener noreferrer" title="{{ social.name }}">
                                    {% if social.icon %}
                                        <i class="{{ social.icon }}"></i>
                                    {% else %}
                                        {{ social.name }}
                                    {% endif %}
                                </a>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="header-avatar-container">
                        <img src="{{ page.avatar | relative_url }}" alt="{{ page.name }}" class="avatar">
                    </div>
                </header>

                <main class="main-content">
                    {{ content }}
                </main>
            </div>
        {% else %}
            <!-- Single Column for CV, Publications, etc. -->
            <main class="main-content single-column">
                <h1>{{ page.title }}</h1>
                {{ content }}
            </main>
        {% endif %}
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            &copy; {{ "now" | date: "%Y" }} {{ site.title }}.
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var links = document.getElementsByTagName('a');
            for (var i = 0; i < links.length; i++) {
                if (links[i].hostname !== window.location.hostname || links[i].href.endsWith('.pdf')) {
                    links[i].target = '_blank';
                    links[i].rel = 'noopener noreferrer';
                }
            }

            // Mobile Menu Toggle logic
            const navToggle = document.getElementById('nav-toggle');
            const navLinks = document.getElementById('nav-links');

            if (navToggle && navLinks) {
                navToggle.addEventListener('click', function(e) {
                    navLinks.classList.toggle('active');
                    
                    // Switch icon
                    const icon = navToggle.querySelector('i');
                    if (navLinks.classList.contains('active')) {
                        icon.classList.remove('fa-bars');
                        icon.classList.add('fa-times');
                    } else {
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                    }
                });

                // Close menu when clicking outside
                document.addEventListener('click', function(e) {
                    if (!navToggle.contains(e.target) && !navLinks.contains(e.target) && navLinks.classList.contains('active')) {
                        navLinks.classList.remove('active');
                        const icon = navToggle.querySelector('i');
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                    }
                });
            }
        });
    </script>
    <script src="{{ '/assets/js/theme-toggle.js' | relative_url }}"></script>

</body>
</html>